{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/misha/Desktop/nextblog/todo/contexts/TodosContext.js\";\nimport { createContext, useState, useRef } from 'react';\nconst TodosContext = /*#__PURE__*/createContext();\n\nconst useDeleteTodo = ({\n  id,\n  abortController = new AbortController()\n}) => {\n  if (!id) return [null, null];\n  const {\n    signal,\n    abort\n  } = abortController || {};\n  console.log(id);\n  const todoRequest = fetch('/api/deleteTodo', {\n    signal: signal,\n    body: JSON.stringify({\n      id\n    }),\n    method: 'DELETE'\n  });\n  return [todoRequest, abort === null || abort === void 0 ? void 0 : abort.bind(abortController)];\n};\n\nconst TodosProvider = ({\n  children\n}) => {\n  const {\n    0: todos,\n    1: setTodos\n  } = useState([]);\n  const {\n    0: todoIdToDelete,\n    1: setIdToDelete\n  } = useState(null);\n  const [todoRequest, abortTodoRequest] = useDeleteTodo({\n    id: todoIdToDelete\n  });\n  const abortFuncs = useRef([]);\n\n  const refreshTodos = async () => {\n    try {\n      const res = await fetch('/api/getTodos');\n      const latestTodos = await res.json();\n      setTodos(latestTodos);\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  const addTodo = async description => {\n    try {\n      const res = await fetch('/api/createTodo', {\n        method: 'POST',\n        body: JSON.stringify({\n          description\n        }),\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n      const newTodo = await res.json();\n      setTodos(prevTodos => [newTodo, ...prevTodos]);\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  const updateTodo = async updatedTodo => {\n    try {\n      await fetch('/api/updateTodo', {\n        method: 'PUT',\n        body: JSON.stringify(updatedTodo),\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n      setTodos(prevTodos => {\n        const existingTodos = [...prevTodos];\n        const existingTodo = existingTodos.find(todo => todo.id === updatedTodo.id);\n        existingTodo.fields = updatedTodo.fields;\n        return existingTodos;\n      });\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  const deleteTodo = async id => {\n    try {\n      setIdToDelete(id);\n      abortFuncs.current.unshift(abortTodoRequest);\n      const newTodoRequest = await todoRequest;\n      const todo = await todoRequest.json();\n      console.log(todo); // await fetch('/api/deleteTodo', {\n      //   method: 'DELETE',\n      //   body: JSON.stringify({ id }),\n      //   headers: { 'Content-Type': 'application/json' },\n      // })\n\n      setTodos(prevTodos => prevTodos.filter(todo => todo.id !== id));\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(TodosContext.Provider, {\n    value: {\n      todos,\n      setTodos,\n      refreshTodos,\n      updateTodo,\n      addTodo,\n      deleteTodo\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 87,\n    columnNumber: 5\n  }, this);\n};\n\nexport { TodosProvider, TodosContext };","map":{"version":3,"sources":["/Users/misha/Desktop/nextblog/todo/contexts/TodosContext.js"],"names":["createContext","useState","useRef","TodosContext","useDeleteTodo","id","abortController","AbortController","signal","abort","console","log","todoRequest","fetch","body","JSON","stringify","method","bind","TodosProvider","children","todos","setTodos","todoIdToDelete","setIdToDelete","abortTodoRequest","abortFuncs","refreshTodos","res","latestTodos","json","e","error","addTodo","description","headers","newTodo","prevTodos","updateTodo","updatedTodo","existingTodos","existingTodo","find","todo","fields","deleteTodo","current","unshift","newTodoRequest","filter"],"mappings":"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","sourcesContent":["import { createContext, useState, useRef } from 'react'\nconst TodosContext = createContext()\n\nconst useDeleteTodo = ({ id, abortController = new AbortController() }) => {\n  if (!id) return [null, null]\n  const { signal, abort } = abortController || {}\n  console.log(id)\n  const todoRequest = fetch('/api/deleteTodo', {\n    signal: signal,\n    body: JSON.stringify({ id }),\n    method: 'DELETE',\n  })\n\n  return [todoRequest, abort?.bind(abortController)]\n}\n\nconst TodosProvider = ({ children }) => {\n  const [todos, setTodos] = useState([])\n  const [todoIdToDelete, setIdToDelete] = useState(null)\n  const [todoRequest, abortTodoRequest] = useDeleteTodo({\n    id: todoIdToDelete,\n  })\n\n  const abortFuncs = useRef([])\n\n  const refreshTodos = async () => {\n    try {\n      const res = await fetch('/api/getTodos')\n      const latestTodos = await res.json()\n      setTodos(latestTodos)\n    } catch (e) {\n      console.error(e)\n    }\n  }\n\n  const addTodo = async description => {\n    try {\n      const res = await fetch('/api/createTodo', {\n        method: 'POST',\n        body: JSON.stringify({ description }),\n        headers: { 'Content-Type': 'application/json' },\n      })\n      const newTodo = await res.json()\n      setTodos(prevTodos => [newTodo, ...prevTodos])\n    } catch (e) {\n      console.error(e)\n    }\n  }\n  const updateTodo = async updatedTodo => {\n    try {\n      await fetch('/api/updateTodo', {\n        method: 'PUT',\n        body: JSON.stringify(updatedTodo),\n        headers: { 'Content-Type': 'application/json' },\n      })\n      setTodos(prevTodos => {\n        const existingTodos = [...prevTodos]\n        const existingTodo = existingTodos.find(\n          todo => todo.id === updatedTodo.id\n        )\n        existingTodo.fields = updatedTodo.fields\n        return existingTodos\n      })\n    } catch (e) {\n      console.error(e)\n    }\n  }\n  const deleteTodo = async id => {\n    try {\n      setIdToDelete(id)\n      abortFuncs.current.unshift(abortTodoRequest)\n      const newTodoRequest = await todoRequest\n      const todo = await todoRequest.json()\n      console.log(todo)\n      // await fetch('/api/deleteTodo', {\n      //   method: 'DELETE',\n      //   body: JSON.stringify({ id }),\n      //   headers: { 'Content-Type': 'application/json' },\n      // })\n      setTodos(prevTodos => prevTodos.filter(todo => todo.id !== id))\n    } catch (e) {\n      console.error(e)\n    }\n  }\n\n  return (\n    <TodosContext.Provider\n      value={{ todos, setTodos, refreshTodos, updateTodo, addTodo, deleteTodo }}\n    >\n      {children}\n    </TodosContext.Provider>\n  )\n}\nexport { TodosProvider, TodosContext }\n"]},"metadata":{},"sourceType":"module"}