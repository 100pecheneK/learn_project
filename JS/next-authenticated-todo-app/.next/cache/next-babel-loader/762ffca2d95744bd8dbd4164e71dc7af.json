{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/misha/Desktop/nextblog/todo/contexts/TodosContext.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport { createContext, useState, useRef } from 'react';\nvar TodosContext = /*#__PURE__*/createContext();\n\nvar useDeleteTodo = function useDeleteTodo(_ref) {\n  var id = _ref.id,\n      _ref$abortController = _ref.abortController,\n      abortController = _ref$abortController === void 0 ? new AbortController() : _ref$abortController;\n  if (!id) return [null, null];\n\n  var _ref2 = abortController || {},\n      signal = _ref2.signal,\n      abort = _ref2.abort;\n\n  console.log(id);\n  var todoRequest = fetch('/api/deleteTodo', {\n    signal: signal,\n    body: JSON.stringify({\n      id: id\n    }),\n    method: 'DELETE',\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return [todoRequest, abort === null || abort === void 0 ? void 0 : abort.bind(abortController)];\n};\n\nvar TodosProvider = function TodosProvider(_ref3) {\n  _s();\n\n  var children = _ref3.children;\n\n  var _useState = useState([]),\n      todos = _useState[0],\n      setTodos = _useState[1];\n\n  var _useState2 = useState(null),\n      todoIdToDelete = _useState2[0],\n      setIdToDelete = _useState2[1];\n\n  var _useDeleteTodo = useDeleteTodo({\n    id: todoIdToDelete\n  }),\n      _useDeleteTodo2 = _slicedToArray(_useDeleteTodo, 2),\n      todoRequest = _useDeleteTodo2[0],\n      abortTodoRequest = _useDeleteTodo2[1];\n\n  var abortFuncs = useRef([]);\n\n  var refreshTodos = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var res, latestTodos;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return fetch('/api/getTodos');\n\n            case 3:\n              res = _context.sent;\n              _context.next = 6;\n              return res.json();\n\n            case 6:\n              latestTodos = _context.sent;\n              setTodos(latestTodos);\n              _context.next = 13;\n              break;\n\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](0);\n              console.error(_context.t0);\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 10]]);\n    }));\n\n    return function refreshTodos() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var addTodo = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(description) {\n      var res, newTodo;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return fetch('/api/createTodo', {\n                method: 'POST',\n                body: JSON.stringify({\n                  description: description\n                }),\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n\n            case 3:\n              res = _context2.sent;\n              _context2.next = 6;\n              return res.json();\n\n            case 6:\n              newTodo = _context2.sent;\n              setTodos(function (prevTodos) {\n                return [newTodo].concat(_toConsumableArray(prevTodos));\n              });\n              _context2.next = 13;\n              break;\n\n            case 10:\n              _context2.prev = 10;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.error(_context2.t0);\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 10]]);\n    }));\n\n    return function addTodo(_x) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var updateTodo = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(updatedTodo) {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              _context3.next = 3;\n              return fetch('/api/updateTodo', {\n                method: 'PUT',\n                body: JSON.stringify(updatedTodo),\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n\n            case 3:\n              setTodos(function (prevTodos) {\n                var existingTodos = _toConsumableArray(prevTodos);\n\n                var existingTodo = existingTodos.find(function (todo) {\n                  return todo.id === updatedTodo.id;\n                });\n                existingTodo.fields = updatedTodo.fields;\n                return existingTodos;\n              });\n              _context3.next = 9;\n              break;\n\n            case 6:\n              _context3.prev = 6;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.error(_context3.t0);\n\n            case 9:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 6]]);\n    }));\n\n    return function updateTodo(_x2) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n\n  var deleteTodo = /*#__PURE__*/function () {\n    var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(id) {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _context4.next = 3;\n              return fetch('/api/deleteTodo', {\n                method: 'DELETE',\n                body: JSON.stringify({\n                  id: id\n                }),\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n\n            case 3:\n              setTodos(function (prevTodos) {\n                return prevTodos.filter(function (todo) {\n                  return todo.id !== id;\n                });\n              });\n              _context4.next = 9;\n              break;\n\n            case 6:\n              _context4.prev = 6;\n              _context4.t0 = _context4[\"catch\"](0);\n              console.error(_context4.t0);\n\n            case 9:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[0, 6]]);\n    }));\n\n    return function deleteTodo(_x3) {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxDEV(TodosContext.Provider, {\n    value: {\n      todos: todos,\n      setTodos: setTodos,\n      refreshTodos: refreshTodos,\n      updateTodo: updateTodo,\n      addTodo: addTodo,\n      deleteTodo: deleteTodo\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(TodosProvider, \"flilsJT9P8W5oCleBMCzZsn1ObU=\", false, function () {\n  return [useDeleteTodo];\n});\n\n_c = TodosProvider;\nexport { TodosProvider, TodosContext };\n\nvar _c;\n\n$RefreshReg$(_c, \"TodosProvider\");","map":{"version":3,"sources":["/Users/misha/Desktop/nextblog/todo/contexts/TodosContext.js"],"names":["createContext","useState","useRef","TodosContext","useDeleteTodo","id","abortController","AbortController","signal","abort","console","log","todoRequest","fetch","body","JSON","stringify","method","headers","bind","TodosProvider","children","todos","setTodos","todoIdToDelete","setIdToDelete","abortTodoRequest","abortFuncs","refreshTodos","res","json","latestTodos","error","addTodo","description","newTodo","prevTodos","updateTodo","updatedTodo","existingTodos","existingTodo","find","todo","fields","deleteTodo","filter"],"mappings":"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","sourcesContent":["import { createContext, useState, useRef } from 'react'\nconst TodosContext = createContext()\n\nconst useDeleteTodo = ({ id, abortController = new AbortController() }) => {\n  if (!id) return [null, null]\n  const { signal, abort } = abortController || {}\n  console.log(id)\n  const todoRequest = fetch('/api/deleteTodo', {\n    signal: signal,\n    body: JSON.stringify({ id }),\n    method: 'DELETE',\n    headers: { 'Content-Type': 'application/json' },\n  })\n\n  return [todoRequest, abort?.bind(abortController)]\n}\n\nconst TodosProvider = ({ children }) => {\n  const [todos, setTodos] = useState([])\n  const [todoIdToDelete, setIdToDelete] = useState(null)\n  const [todoRequest, abortTodoRequest] = useDeleteTodo({\n    id: todoIdToDelete,\n  })\n\n  const abortFuncs = useRef([])\n\n  const refreshTodos = async () => {\n    try {\n      const res = await fetch('/api/getTodos')\n      const latestTodos = await res.json()\n      setTodos(latestTodos)\n    } catch (e) {\n      console.error(e)\n    }\n  }\n\n  const addTodo = async description => {\n    try {\n      const res = await fetch('/api/createTodo', {\n        method: 'POST',\n        body: JSON.stringify({ description }),\n        headers: { 'Content-Type': 'application/json' },\n      })\n      const newTodo = await res.json()\n      setTodos(prevTodos => [newTodo, ...prevTodos])\n    } catch (e) {\n      console.error(e)\n    }\n  }\n  const updateTodo = async updatedTodo => {\n    try {\n      await fetch('/api/updateTodo', {\n        method: 'PUT',\n        body: JSON.stringify(updatedTodo),\n        headers: { 'Content-Type': 'application/json' },\n      })\n      setTodos(prevTodos => {\n        const existingTodos = [...prevTodos]\n        const existingTodo = existingTodos.find(\n          todo => todo.id === updatedTodo.id\n        )\n        existingTodo.fields = updatedTodo.fields\n        return existingTodos\n      })\n    } catch (e) {\n      console.error(e)\n    }\n  }\n  const deleteTodo = async id => {\n    try {\n      await fetch('/api/deleteTodo', {\n        method: 'DELETE',\n        body: JSON.stringify({ id }),\n        headers: { 'Content-Type': 'application/json' },\n      })\n      setTodos(prevTodos => prevTodos.filter(todo => todo.id !== id))\n    } catch (e) {\n      console.error(e)\n    }\n  }\n\n  return (\n    <TodosContext.Provider\n      value={{ todos, setTodos, refreshTodos, updateTodo, addTodo, deleteTodo }}\n    >\n      {children}\n    </TodosContext.Provider>\n  )\n}\nexport { TodosProvider, TodosContext }\n"]},"metadata":{},"sourceType":"module"}